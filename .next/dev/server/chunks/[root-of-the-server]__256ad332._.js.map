{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Nikhil/Downloads/healthcare-translation-app%20%281%29/app/api/whisper/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport dotenv from \"dotenv\";\n\nimport { experimental_transcribe as transcribe } from \"ai\";\n// import { azure } from \"@ai-sdk/azure\";\n// import { createAzure } from \"@ai-sdk/azure\";\nimport fs from \"fs\";\n// import { groq } from '@ai-sdk/groq';\nimport { createGroq } from \"@ai-sdk/groq\";\nimport { readFile } from 'fs/promises';\ndotenv.config();\n\n// const azure = createAzure({\n//   resourceName: process.env.AZURE_OPENAI_API_INSTANCE_NAME as string,\n//   apiKey: process.env.AZURE_OPENAI_API_KEY as string,\n//     useDeploymentBasedUrls: true,\n//   apiVersion: '2025-04-01-preview',\n// });\nconsole.log(\"✅ Groq model loaded\",process.env.GROK_API_KEY);\n\nconst groq = createGroq({\n  apiKey: process.env.GROK_API_KEY as string,\n});\n\n\nexport async function POST(req: NextRequest) {\n  try {\n    const formData = await req.formData();\n    const audio = formData.get(\"audio\") as Blob;\n\n    if (!audio) {\n      return NextResponse.json(\n        { error: \"No audio file provided\" },\n        { status: 400 }\n      );\n    }\n\n    // Convert Blob to Buffer\n    const arrayBuffer = await audio.arrayBuffer();\n    const buffer = Buffer.from(arrayBuffer);\n\n\nconst result = await transcribe({\n  model: groq.transcription('whisper-large-v3'),\n  audio: buffer,\n  providerOptions: { groq: { translate: false } },\n});\n    // Whisper azureeee transcription\n    // const result = await transcribe({\n    //   model: azure.transcription(\"whisper-1\"),\n    //   audio: buffer,\n    //   providerOptions: {\n    //     openai: {\n    //       // Explicit language or auto-detect\n    //       language: \"en\", \n    //     },\n    //   },\n    // });\n    console.log(\"Transcription result:\", result, result.language);\n       const raw = result.responses?.[0];\n\n    console.log(\"Detected Language:\", raw);\n  \n\n    return NextResponse.json({\n      text: result.text,\n\n      language: result.language || \"unknown\",\n    });\n  } catch (error) {\n    console.error(\"Azure transcription error:\", error);\n    return NextResponse.json({ error: \"Server error\" }, { status: 500 });\n  }\n}\n\n\n// export async function POST(req: NextRequest) {\n//   try {\n//     const formData = await req.formData();\n//     const audio = formData.get(\"audio\") as Blob;\n\n//     if (!audio) {\n//       return NextResponse.json(\n//         { error: \"No audio file provided\" },\n//         { status: 400 }\n//       );\n//     }\n\n//     // Convert Blob → Buffer → File\n//     const arrayBuffer = await audio.arrayBuffer();\n//     const buffer = Buffer.from(arrayBuffer);\n\n//     const file = new File([buffer], \"audio.webm\", {\n//       type: audio.type || \"audio/webm\",\n//     });\n\n//     const openai = new OpenAI({\n//       apiKey: process.env.OPENAI_API_KEY,\n//     });\n\n//     const stream = await openai.audio.transcriptions.create({\n//       file,\n//       model: \"gpt-4o-mini-transcribe\",\n//       response_format: \"text\",\n//       stream: true,\n//     });\n\n//     for await (const event of stream) {\n//       console.log(event);\n//     }\n\n//     return NextResponse.json({\n//       text: \"Transcription result here\",\n//       language: \"en\",\n//     });\n//   } catch (error) {\n//     console.error(\"Azure transcription error:\", error);\n//     return NextResponse.json({ error: \"Server error\" }, { status: 500 });\n//   }\n// }\n"],"names":[],"mappings":";;;;AAAA;AACA;AAEA;AAIA,uCAAuC;AACvC;;;;;AAEA,kJAAM,CAAC,MAAM;AAEb,8BAA8B;AAC9B,wEAAwE;AACxE,wDAAwD;AACxD,oCAAoC;AACpC,sCAAsC;AACtC,MAAM;AACN,QAAQ,GAAG,CAAC,uBAAsB,QAAQ,GAAG,CAAC,YAAY;AAE1D,MAAM,OAAO,IAAA,2PAAU,EAAC;IACtB,QAAQ,QAAQ,GAAG,CAAC,YAAY;AAClC;AAGO,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,MAAM,WAAW,MAAM,IAAI,QAAQ;QACnC,MAAM,QAAQ,SAAS,GAAG,CAAC;QAE3B,IAAI,CAAC,OAAO;YACV,OAAO,yPAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAyB,GAClC;gBAAE,QAAQ;YAAI;QAElB;QAEA,yBAAyB;QACzB,MAAM,cAAc,MAAM,MAAM,WAAW;QAC3C,MAAM,SAAS,OAAO,IAAI,CAAC;QAG/B,MAAM,SAAS,MAAM,IAAA,uPAAU,EAAC;YAC9B,OAAO,KAAK,aAAa,CAAC;YAC1B,OAAO;YACP,iBAAiB;gBAAE,MAAM;oBAAE,WAAW;gBAAM;YAAE;QAChD;QACI,iCAAiC;QACjC,oCAAoC;QACpC,6CAA6C;QAC7C,mBAAmB;QACnB,uBAAuB;QACvB,gBAAgB;QAChB,4CAA4C;QAC5C,yBAAyB;QACzB,SAAS;QACT,OAAO;QACP,MAAM;QACN,QAAQ,GAAG,CAAC,yBAAyB,QAAQ,OAAO,QAAQ;QACzD,MAAM,MAAM,OAAO,SAAS,EAAE,CAAC,EAAE;QAEpC,QAAQ,GAAG,CAAC,sBAAsB;QAGlC,OAAO,yPAAY,CAAC,IAAI,CAAC;YACvB,MAAM,OAAO,IAAI;YAEjB,UAAU,OAAO,QAAQ,IAAI;QAC/B;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO,yPAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;IACpE;AACF,EAGA,iDAAiD;CACjD,UAAU;CACV,6CAA6C;CAC7C,mDAAmD;CAEnD,oBAAoB;CACpB,kCAAkC;CAClC,+CAA+C;CAC/C,0BAA0B;CAC1B,WAAW;CACX,QAAQ;CAER,sCAAsC;CACtC,qDAAqD;CACrD,+CAA+C;CAE/C,sDAAsD;CACtD,0CAA0C;CAC1C,UAAU;CAEV,kCAAkC;CAClC,4CAA4C;CAC5C,UAAU;CAEV,gEAAgE;CAChE,cAAc;CACd,yCAAyC;CACzC,iCAAiC;CACjC,sBAAsB;CACtB,UAAU;CAEV,0CAA0C;CAC1C,4BAA4B;CAC5B,QAAQ;CAER,iCAAiC;CACjC,2CAA2C;CAC3C,wBAAwB;CACxB,UAAU;CACV,sBAAsB;CACtB,0DAA0D;CAC1D,4EAA4E;CAC5E,MAAM;CACN,IAAI"}}]
}